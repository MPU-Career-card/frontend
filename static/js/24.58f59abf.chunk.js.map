{"version":3,"file":"static/js/24.58f59abf.chunk.js","mappings":"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","sources":["pages/specialties/ui/specialties.tsx"],"sourcesContent":["import {\n    ChangeEvent,\n    useEffect,\n    useRef,\n    useState,\n} from 'react';\n\nimport { AxiosError } from 'axios';\n\nimport {\n    Footer,\n    SpecialitiesPromo,\n    FacultiesAccordions,\n} from 'widgets';\nimport { Container } from 'shared/ui';\nimport {\n    debounce,\n    facultiesApi,\n    getFaculty,\n    searchSpecialities,\n} from 'shared/lib';\nimport { Specialities } from 'shared/types';\n\nimport { Loading } from '../../loading';\nimport { Error } from '../../error';\n\nconst SpecialtiesPage = () => {\n    const [specialities, setSpecialities] = useState<Specialities>({});\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [errorStatus, setErrorStatus] = useState<number | undefined>(undefined);\n    const [errorText, setErrorText] = useState<string | undefined>(undefined);\n    const [showError, setShowError] = useState(false);\n\n    const isSearching = useRef<boolean>(false);\n\n    const resetError = () => {\n        setErrorStatus(undefined);\n        setErrorText(undefined);\n        setShowError(false);\n    };\n\n    const getFaculties = async () => {\n        try {\n            resetError(); // Сброс ошибок перед загрузкой\n            setIsLoading(true);\n\n            const { data: faculties } = await facultiesApi.get<string[]>('');\n            const specialities = faculties.reduce((acc, faculty) => ({\n                ...acc,\n                [faculty]: [],\n            }), {});\n\n            setSpecialities(specialities);\n        } catch (err) {\n            if (err instanceof AxiosError) {\n                const status = err.response?.status || 500; // Если status отсутствует, установить 500\n                const detail = err.response?.data?.detail || 'Произошла ошибка'; // Если detail отсутствует, установить дефолтное сообщение\n\n                setErrorStatus(status);\n                setErrorText(detail || 'Ошибка загрузки факультетов');\n            }\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const getSpecialities = async (faculty: string) => {\n        if (isSearching.current) return;\n\n        try {\n            resetError(); // Сброс ошибок перед загрузкой\n\n            const { data } = await getFaculty(faculty);\n\n            setSpecialities((specialities) => ({\n                ...specialities,\n                [faculty]: data.specialities,\n            }));\n        } catch (err) {\n            if (err instanceof AxiosError) {\n                const status = err.response?.status || 500;\n                const detail = err.response?.data?.detail || 'Произошла ошибка';\n\n                setErrorStatus(status);\n                setErrorText(detail || 'Ошибка загрузки специальностей');\n            }\n        }\n    };\n\n    const search = async (search: string) => {\n        if (!search) {\n            isSearching.current = false;\n            await getFaculties(); // Загрузка всех факультетов при пустом поиске\n            return;\n        }\n\n        try {\n            resetError(); // Сброс ошибок перед поиском\n            isSearching.current = true;\n\n            const { data } = await searchSpecialities(search);\n            const specialities: Specialities = Object.keys(data).reduce((acc, faculty) => ({\n                ...acc,\n                [faculty]: data[faculty].specialities,\n            }), {});\n\n            setSpecialities(specialities);\n        } catch (err) {\n            if (err instanceof AxiosError) {\n                const status = err.response?.status || 500;\n                const detail = err.response?.data?.detail || 'Произошла ошибка';\n\n                setErrorStatus(status);\n                setErrorText(detail || 'Ошибка поиска специальностей');\n            }\n        }\n    };\n\n    const debouncedSearch = debounce(search, 300);\n\n    const onSearchInputChange = (e: ChangeEvent<HTMLInputElement>) => {\n        debouncedSearch(e.target.value);\n    };\n\n    useEffect(() => {\n        getFaculties();\n    }, []);\n\n    useEffect(() => {\n        if (errorStatus || errorText) {\n            const timeout = setTimeout(() => setShowError(true), 1000);\n            return () => clearTimeout(timeout);\n        }\n        setShowError(false);\n        return undefined;\n    }, [errorStatus, errorText]);\n    // Показываем ошибку только если она подтверждена и данные пустые\n    const shouldShowError = showError && Object.keys(specialities).length === 0;\n\n    if (isLoading) {\n        return <Loading />;\n    }\n\n    if (shouldShowError) {\n        return (\n            <Error\n                status={errorStatus}\n                description={errorText}\n            />\n        );\n    }\n\n    return (\n        <Container>\n            <SpecialitiesPromo\n                image={`${process.env.PUBLIC_URL}/assets/promo.jpg`}\n                title=\"Карьерные карты\"\n                description=\"Проект, который поможет тебе определиться с\n                будущей профессией и выбрать нужное направление подготовки в Московском Политехе\"\n            />\n            <FacultiesAccordions\n                specialities={specialities}\n                getSpecialities={getSpecialities}\n                onSearchInputChange={onSearchInputChange}\n                marginTop={100}\n                marginBottom={100}\n            />\n            <Footer />\n        </Container>\n    );\n};\n\nexport default SpecialtiesPage;\n"],"names":["SpecialtiesPage","specialities","setSpecialities","useState","isLoading","setIsLoading","errorStatus","setErrorStatus","undefined","errorText","setErrorText","showError","setShowError","isSearching","useRef","resetError","getFaculties","async","data","faculties","facultiesApi","get","reduce","acc","faculty","err","AxiosError","_err$response","_err$response2","_err$response2$data","status","response","detail","debouncedSearch","debounce","search","current","searchSpecialities","Object","keys","_err$response5","_err$response6","_err$response6$data","useEffect","timeout","setTimeout","clearTimeout","shouldShowError","length","_jsx","Loading","Error","description","_jsxs","Container","children","SpecialitiesPromo","image","title","FacultiesAccordions","getSpecialities","getFaculty","_err$response3","_err$response4","_err$response4$data","onSearchInputChange","e","target","value","marginTop","marginBottom","Footer"],"sourceRoot":""}